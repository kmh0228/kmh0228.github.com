(function($) {
	$.fn.keyboard = function(a) {
		var a = $.extend({
			keyColors: ['rgb(0, 255, 100)', 'rgb(255, 225, 0)', 'rgb(255, 100, 0)', 'rgb(255, 0, 75)', 'rgb(150, 0, 255)', 'rgb(0, 150, 255)']
		}, a || {});
		addDom(this);
		initStyle(this, a);
		addEL(this, a)
	};

	function addDom(a) {}
	function initStyle(a, b) {}
	function addEL(f, g) {
		var h = f.find('li').not('.gw');
		var j = [];
		h.each(function(i, e) {
			var a = {};
			var e = a.e = $(e);
			a.key = e.attr('data_index');
			a.x = parseInt(e.position().left + (e.outerWidth() / 2) + 2);
			a.y = parseInt(e.position().top + (e.outerHeight() / 2) + 2);
			j.push(a);
		});
		j.sort(function(a, b) {
			return (b.x - b.y) - (a.x - a.y)
		});
		var k = j.length;
		var l = g.keyColors;
		var m = l.length;
		var o = k / m;
		for (var i = 0; i < k; i++) {
			var p = l[parseInt(i / o)];
			j[i].initcolor = p;
			j[i].e.css({
				'color': p,
				'border-color': p,
				'box-shadow': '0 0 5px ' + p
			})
		}
		var t = 0;
		var q = setInterval(linearColor, 1000);

		function linearColor() {
			t++;
			for (var i = 0; i < k; i++) {
				var a = l[(parseInt(i / o) + t) % m];
				j[i].initcolor = a;
				j[i].e.css({
					'color': a,
					'border-color': a,
					'box-shadow': '0 0 5px ' + a
				})
			}
			setObjBorder()
		}
		function setObjBorder() {
			var n = parseInt(0 + Math.random() * m);
			f.css({
				'box-shadow': '0 0 200px 0 ' + l[n] + ' inset'
			})
		}
		setObjBorder();

		function findKey(a) {
			for (var i = 0; i < k; i++) {
				if (j[i].key == a) {
					return j[i]
				}
			}
			return false
		}
		var r;
		$(document).on('keydown', function(a) {
			var b = findKey(a.keyCode);
			if (!b) {
				alert('请切换至英文输入');
				return
			}
			b.press = true;
			var c = document.createElement('video');
			c.src = "music/keydown.mp3";
			c.play();
			var d = b.initcolor;
			b.e.css({
				'color': '#fff',
				'background': d,
				'box-shadow': '0 0 5px ' + d,
				'transform': 'scale(1.1)'
			});
			clearInterval(q);
			clearTimeout(r)
		});
		$(document).on('keyup', function(b) {
			var c = findKey(b.keyCode);
			if (!c) {
				alert('请切换至英文输入');
				return
			}
			c.press = false;
			var d = c.initcolor;
			c.e.css({
				'color': d,
				'background': 'none',
				'box-shadow': '0 0 5px ' + d,
				'transform': 'scale(1)',
			});
			clearInterval(q);
			r = setTimeout(function() {
				clearInterval(q);
				clearTimeout(r);
				q = setInterval(linearColor, 1500)
			}, 8000);
			for (var i = 0; i < k; i++) {
				(function(i) {
					var a = j[i].time = Math.abs(j[i].x - c.x) + (Math.abs(j[i].y - c.y) * 3);
					if (j[i].press) return;
					j[i].timeout = setTimeout(function() {
						clearTimeout(j[i].timeout);
						j[i].e.css({
							'color': d,
							'border-color': d,
							'box-shadow': '0 0 5px ' + d
						});
						j[i].distimeout = setTimeout(function() {
							clearTimeout(j[i].distimeout);
							j[i].e.css({
								'color': j[i].initcolor,
								'border-color': j[i].initcolor,
								'box-shadow': '0 0 5px ' + j[i].initcolor
							})
						}, 50)
					}, j[i].time)
				})(i)
			}
		})
	}
})(jQuery);